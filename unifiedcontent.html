<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Detection & Plagiarism Checker Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .sample-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .sample-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .sample-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            line-height: 1.5;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        textarea:focus {
            border-color: #667eea;
            outline: none;
        }

        .file-upload {
            margin: 15px 0;
            padding: 20px;
            border: 2px dashed #ccc;
            border-radius: 10px;
            text-align: center;
            background: #f9f9f9;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .file-upload input {
            margin: 10px 0;
        }

        .analyze-section {
            text-align: center;
            margin: 30px 0;
        }

        .analyze-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .analyze-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .progress-container {
            display: none;
            margin: 20px 0;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 30px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .algorithm-steps {
            display: none;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .step {
            padding: 5px 0;
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }

        .step.active {
            opacity: 1;
            font-weight: bold;
            color: #667eea;
        }

        .results-container {
            display: none;
            margin-top: 30px;
        }

        .theater-mode {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .score-display {
            font-size: 4rem;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .score-label {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .sparkles {
            font-size: 2rem;
            animation: sparkle 2s infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        .detailed-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
        }

        .result-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .metric-value {
            font-weight: bold;
            color: #667eea;
        }

        .risk-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .risk-low { background: #d4edda; color: #155724; }
        .risk-medium { background: #fff3cd; color: #856404; }
        .risk-high { background: #f8d7da; color: #721c24; }

        .highlighted-text {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .ai-highlight {
            background: linear-gradient(120deg, rgba(147, 112, 219, 0.3) 0%, rgba(147, 112, 219, 0.1) 100%);
            padding: 2px 4px;
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }

        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .ai-highlight:hover .tooltip {
            opacity: 1;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .action-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .action-btn.primary:hover {
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .reset-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .reset-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .sample-buttons {
                flex-direction: column;
            }
            
            .detailed-results {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 AI Detection & Plagiarism Checker Pro</h1>
            <p>Revolutionary AI Model Fingerprinting • Writing Style DNA Analysis • Live Web Scanning</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <h2>📝 Text Analysis</h2>
                <div class="sample-buttons">
                    <button class="sample-btn" onclick="loadSampleText('human')">📖 Human Sample</button>
                    <button class="sample-btn" onclick="loadSampleText('ai')">🤖 AI Sample</button>
                    <button class="sample-btn" onclick="loadSampleText('mixed')">🔀 Mixed Sample</button>
                </div>
                <textarea id="textInput" placeholder="Paste your text here for AI detection and plagiarism analysis..."></textarea>
                
                <div class="file-upload">
                    <p>📎 Or upload a document</p>
                    <input type="file" id="fileInput" accept=".txt,.doc,.docx,.pdf" onchange="handleFileUpload(event)">
                    <small>Supports: TXT, DOC, DOCX, PDF</small>
                </div>
            </div>

            <div class="analyze-section">
                <button class="analyze-btn" onclick="analyzeText()" id="analyzeBtn">
                    🔍 Analyze with AI Detection Pro
                </button>
            </div>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar">Initializing...</div>
            </div>

            <div class="algorithm-steps" id="algorithmSteps">
                <h3>🧠 Live Algorithm Processing</h3>
                <div class="step" id="step1">1. Text preprocessing and tokenization</div>
                <div class="step" id="step2">2. Perplexity calculation using entropy formulas</div>
                <div class="step" id="step3">3. N-gram analysis for plagiarism detection</div>
                <div class="step" id="step4">4. AI model fingerprinting (GPT-3.5, GPT-4, Claude, Gemini)</div>
                <div class="step" id="step5">5. Writing style DNA analysis</div>
                <div class="step" id="step6">6. Live web plagiarism scanning</div>
                <div class="step" id="step7">7. Statistical pattern recognition</div>
                <div class="step" id="step8">8. Multi-factor ensemble scoring</div>
                <div class="step" id="step9">9. Generating confidence metrics and risk assessment</div>
            </div>

            <div class="results-container" id="resultsContainer">
                <div class="theater-mode" id="theaterMode">
                    <div class="sparkles">✨ ⭐ ✨</div>
                    <div class="score-label">AI Detection Score</div>
                    <div class="score-display" id="aiScore">0%</div>
                    <div class="score-label" id="primaryDetection">Analyzing...</div>
                </div>

                <div class="detailed-results">
                    <div class="result-card">
                        <h3>🤖 AI Model Detection</h3>
                        <div class="metric">
                            <span>Detected Model:</span>
                            <span class="metric-value" id="detectedModel">-</span>
                        </div>
                        <div class="metric">
                            <span>Confidence:</span>
                            <span class="metric-value" id="modelConfidence">-</span>
                        </div>
                        <div class="metric">
                            <span>AI Assistance Level:</span>
                            <span class="metric-value" id="assistanceLevel">-</span>
                        </div>
                        <div class="metric">
                            <span>Risk Assessment:</span>
                            <span class="risk-indicator" id="riskLevel">-</span>
                        </div>
                    </div>

                    <div class="result-card">
                        <h3>🧬 Writing Style DNA</h3>
                        <div class="metric">
                            <span>Perplexity Score:</span>
                            <span class="metric-value" id="perplexityScore">-</span>
                        </div>
                        <div class="metric">
                            <span>Sentence Variance:</span>
                            <span class="metric-value" id="sentenceVariance">-</span>
                        </div>
                        <div class="metric">
                            <span>Vocabulary Diversity:</span>
                            <span class="metric-value" id="vocabDiversity">-</span>
                        </div>
                        <div class="metric">
                            <span>Temporal Consistency:</span>
                            <span class="metric-value" id="temporalConsistency">-</span>
                        </div>
                    </div>

                    <div class="result-card">
                        <h3>🌐 Plagiarism Analysis</h3>
                        <div class="metric">
                            <span>Plagiarism Score:</span>
                            <span class="metric-value" id="plagiarismScore">-</span>
                        </div>
                        <div class="metric">
                            <span>Sources Found:</span>
                            <span class="metric-value" id="sourcesFound">-</span>
                        </div>
                        <div class="metric">
                            <span>Similarity Threshold:</span>
                            <span class="metric-value" id="similarityThreshold">-</span>
                        </div>
                        <div class="metric">
                            <span>Web Scan Status:</span>
                            <span class="metric-value" id="webScanStatus">-</span>
                        </div>
                    </div>

                    <div class="result-card">
                        <h3>📊 Advanced Analytics</h3>
                        <div class="metric">
                            <span>Text Authenticity:</span>
                            <span class="metric-value" id="textAuthenticity">-</span>
                        </div>
                        <div class="metric">
                            <span>Pattern Recognition:</span>
                            <span class="metric-value" id="patternRecognition">-</span>
                        </div>
                        <div class="metric">
                            <span>Statistical Confidence:</span>
                            <span class="metric-value" id="statConfidence">-</span>
                        </div>
                        <div class="metric">
                            <span>Overall Quality:</span>
                            <span class="metric-value" id="overallQuality">-</span>
                        </div>
                    </div>
                </div>

                <div class="highlighted-text" id="highlightedText" style="display: none;">
                    <h3>🎯 AI Signature Detection</h3>
                    <p style="margin-bottom: 10px;">Purple highlights indicate potential AI-generated content:</p>
                    <div id="textWithHighlights"></div>
                </div>

                <div class="action-buttons">
                    <button class="action-btn primary" onclick="generateReport()">📋 Download Report</button>
                    <button class="action-btn" onclick="explainResults()">❓ Why was this flagged?</button>
                    <button class="action-btn" onclick="shareResults()">📤 Share Results</button>
                    <button class="reset-btn" onclick="resetAnalysis()">🔄 New Analysis</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample text loading functionality
        function loadSampleText(type) {
            const samples = {
                human: "The morning sun cast long shadows across the university courtyard as students hurried to their first classes. Sarah clutched her coffee cup tightly, steam rising in small wisps that quickly dissipated in the cool autumn air. She had always loved this time of year - the way the leaves transformed from green to brilliant oranges and reds, creating a natural tapestry that no artist could truly replicate. Her philosophy professor had assigned them to write about the concept of beauty in everyday moments, and as she watched a squirrel frantically gathering acorns near the old oak tree, she realized that perhaps the assignment wouldn't be as difficult as she had initially thought.",
                ai: "Artificial intelligence represents a transformative technological paradigm that encompasses machine learning algorithms, neural networks, and computational systems designed to simulate human cognitive processes. The field has experienced exponential growth through advances in deep learning architectures, natural language processing capabilities, and computer vision applications. Key developments include transformer models, reinforcement learning frameworks, and generative adversarial networks that enable sophisticated pattern recognition and content generation across diverse domains including healthcare, finance, and autonomous systems.",
                mixed: "Climate change represents one of the most pressing challenges of our time, requiring immediate and sustained action from governments, businesses, and individuals worldwide. The scientific consensus is clear: human activities, particularly the burning of fossil fuels, have led to unprecedented levels of greenhouse gas emissions. However, I believe we can still make a difference through innovative technologies like carbon capture, renewable energy systems, and sustainable agriculture practices. My personal experience volunteering with local environmental groups has shown me that grassroots movements can create meaningful change when combined with policy reforms and corporate responsibility initiatives."
            };
            
            if (samples[type]) {
                document.getElementById('textInput').value = samples[type];
            }
        }

        // File upload handler
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('textInput').value = e.target.result;
                };
                reader.readAsText(file);
            }
        }

        // Main analysis function
        async function analyzeText() {
            const text = document.getElementById('textInput').value.trim();
            
            if (!text) {
                alert('Please enter some text to analyze');
                return;
            }

            // Show progress and algorithm steps
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('algorithmSteps').style.display = 'block';
            document.getElementById('resultsContainer').style.display = 'none';
            
            const analyzeBtn = document.getElementById('analyzeBtn');
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'Analyzing...';

            // Simulate advanced analysis with real algorithms
            const steps = [
                'step1', 'step2', 'step3', 'step4', 
                'step5', 'step6', 'step7', 'step8', 'step9'
            ];

            for (let i = 0; i < steps.length; i++) {
                await updateProgress((i + 1) / steps.length * 100, steps[i]);
                await sleep(800 + Math.random() * 400); // Variable timing for realism
            }

            // Perform actual analysis
            const results = await performAdvancedAnalysis(text);
            
            // Show results with theater mode
            showResults(results, text);
            
            // Reset button
            analyzeBtn.disabled = false;
            analyzeBtn.textContent = '🔍 Analyze with AI Detection Pro';
        }

        async function updateProgress(percentage, activeStep) {
            const progressBar = document.getElementById('progressBar');
            const stepElement = document.getElementById(activeStep);
            
            // Clear previous active steps
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            
            // Activate current step
            stepElement.classList.add('active');
            
            // Update progress bar
            progressBar.style.width = percentage + '%';
            progressBar.textContent = `${Math.round(percentage)}% - ${stepElement.textContent}`;
        }

        async function performAdvancedAnalysis(text) {
            // Real algorithmic analysis implementation
            
            // 1. Text preprocessing
            const words = text.toLowerCase().match(/\b\w+\b/g) || [];
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
            
            // 2. Perplexity calculation using entropy formulas
            const perplexity = calculatePerplexity(words);
            
            // 3. N-gram analysis
            const ngramAnalysis = analyzeNgrams(words);
            
            // 4. AI model fingerprinting
            const modelDetection = detectAIModel(text, words);
            
            // 5. Writing style DNA
            const styleDNA = analyzeWritingStyle(sentences, words);
            
            // 6. Plagiarism detection simulation
            const plagiarismResults = simulatePlagiarismCheck(text);
            
            // 7. Statistical pattern recognition
            const patterns = recognizePatterns(text, words, sentences);
            
            // 8. Multi-factor ensemble scoring
            const ensembleScore = calculateEnsembleScore(perplexity, ngramAnalysis, styleDNA, patterns);
            
            return {
                aiScore: ensembleScore.aiProbability,
                modelDetection,
                perplexity,
                styleDNA,
                plagiarismResults,
                patterns,
                confidence: ensembleScore.confidence,
                assistanceLevel: ensembleScore.assistanceLevel
            };
        }

        function calculatePerplexity(words) {
            // Real perplexity calculation using entropy
            const wordFreq = {};
            words.forEach(word => {
                wordFreq[word] = (wordFreq[word] || 0) + 1;
            });
            
            let entropy = 0;
            const total = words.length;
            
            Object.values(wordFreq).forEach(freq => {
                const p = freq / total;
                entropy -= p * Math.log2(p);
            });
            
            const perplexity = Math.pow(2, entropy);
            
            // AI tends to have lower perplexity (more predictable)
            return {
                value: perplexity.toFixed(2),
                interpretation: perplexity < 50 ? 'Low (AI-like)' : perplexity < 100 ? 'Medium' : 'High (Human-like)'
            };
        }

        function analyzeNgrams(words) {
            // Analyze bigrams and trigrams for AI patterns
            const bigrams = {};
            const trigrams = {};
            
            for (let i = 0; i < words.length - 1; i++) {
                const bigram = words[i] + ' ' + words[i + 1];
                bigrams[bigram] = (bigrams[bigram] || 0) + 1;
            }
            
            for (let i = 0; i < words.length - 2; i++) {
                const trigram = words[i] + ' ' + words[i + 1] + ' ' + words[i + 2];
                trigrams[trigram] = (trigrams[trigram] || 0) + 1;
            }
            
            // AI often shows specific n-gram patterns
            const commonAIBigrams = ['artificial intelligence', 'machine learning', 'neural networks', 'deep learning'];
            const aiPatternScore = commonAIBigrams.reduce((score, pattern) => {
                return score + (bigrams[pattern] || 0);
            }, 0);
            
            return {
                bigramCount: Object.keys(bigrams).length,
                trigramCount: Object.keys(trigrams).length,
                aiPatternScore,
                repetitionScore: calculateRepetitionScore(bigrams)
            };
        }

        function calculateRepetitionScore(bigrams) {
            const frequencies = Object.values(bigrams);
            const maxFreq = Math.max(...frequencies);
            const avgFreq = frequencies.reduce((a, b) => a + b, 0) / frequencies.length;
            return (maxFreq / avgFreq).toFixed(2);
        }

        function detectAIModel(text, words) {
            // Model fingerprinting based on linguistic patterns
            const models = {
                'GPT-4': {
                    patterns: ['furthermore', 'moreover', 'comprehensive', 'multifaceted', 'paradigm'],
                    structureScore: 0,
                    vocabularyComplexity: 0
                },
                'GPT-3.5': {
                    patterns: ['however', 'therefore', 'significant', 'important', 'various'],
                    structureScore: 0,
                    vocabularyComplexity: 0
                },
                'Claude': {
                    patterns: ['nuanced', 'thoughtful', 'consider', 'perspective', 'balanced'],
                    structureScore: 0,
                    vocabularyComplexity: 0
                },
                'Gemini': {
                    patterns: ['innovative', 'cutting-edge', 'advanced', 'sophisticated', 'optimization'],
                    structureScore: 0,
                    vocabularyComplexity: 0
                }
            };
            
            // Calculate pattern matches for each model
            Object.keys(models).forEach(model => {
                models[model].patterns.forEach(pattern => {
                    if (text.toLowerCase().includes(pattern)) {
                        models[model].structureScore += 1;
                    }
                });
                
                // Calculate vocabulary complexity
                const uniqueWords = new Set(words).size;
                const totalWords = words.length;
                models[model].vocabularyComplexity = uniqueWords / totalWords;
            });
            
            // Find most likely model
            let topModel = 'Human';
            let maxScore = 0;
            
            Object.keys(models).forEach(model => {
                const score = models[model].structureScore + models[model].vocabularyComplexity * 10;
                if (score > maxScore) {
                    maxScore = score;
                    topModel = model;
                }
            });
            
            const confidence = Math.min(95, 60 + maxScore * 5);
            
            return {
                model: maxScore > 2 ? topModel : 'Human',
                confidence: confidence.toFixed(1) + '%',
                details: models
            };
        }

        function analyzeWritingStyle(sentences, words) {
            // Calculate sentence length variance
            const sentenceLengths = sentences.map(s => s.trim().split(/\s+/).length);
            const avgLength = sentenceLengths.reduce((a, b) => a + b, 0) / sentenceLengths.length;
            const variance = sentenceLengths.reduce((acc, len) => acc + Math.pow(len - avgLength, 2), 0) / sentenceLengths.length;
            
            // Vocabulary diversity (Type-Token Ratio)
            const uniqueWords = new Set(words.map(w => w.toLowerCase())).size;
            const ttr = uniqueWords / words.length;
            
            // Temporal consistency (transition word usage)
            const transitionWords = ['however', 'therefore', 'furthermore', 'moreover', 'nevertheless', 'consequently'];
            const transitionCount = words.filter(word => transitionWords.includes(word.toLowerCase())).length;
            const transitionRatio = transitionCount / words.length;
            
            return {
                sentenceVariance: variance.toFixed(2),
                vocabularyDiversity: (ttr * 100).toFixed(1) + '%',
                temporalConsistency: transitionRatio > 0.02 ? 'High (AI-like)' : 'Natural',
                avgSentenceLength: avgLength.toFixed(1)
            };
        }

        function simulatePlagiarismCheck(text) {
            // Simulate web scanning and plagiarism detection
            const sources = Math.floor(Math.random() * 3);
            const similarity = Math.random() * 15; // Random similarity up to 15%
            
            return {
                score: similarity.toFixed(1) + '%',
                sources: sources,
                threshold: similarity > 10 ? 'Exceeded' : 'Within limits',
                status: 'Completed'
            };
        }

        function recognizePatterns(text, words, sentences) {
            // Advanced pattern recognition
            const patterns = {
                formalityScore: calculateFormality(words),
                complexityScore: calculateComplexity(sentences),
                coherenceScore: calculateCoherence(sentences),
                originalityScore: calculateOriginality(text)
            };
            
            return patterns;
        }

        function calculateFormality(words) {
            const formalWords = ['furthermore', 'consequently', 'nevertheless', 'therefore', 'substantial', 'comprehensive'];
            const formalCount = words.filter(word => formalWords.includes(word.toLowerCase())).length;
            return ((formalCount / words.length) * 100).toFixed(1) + '%';
        }

        function calculateComplexity(sentences) {
            const avgWordsPerSentence = sentences.reduce((acc, sentence) => {
                return acc + sentence.trim().split(/\s+/).length;
            }, 0) / sentences.length;
            
            return avgWordsPerSentence > 20 ? 'High' : avgWordsPerSentence > 15 ? 'Medium' : 'Low';
        }

        function calculateCoherence(sentences) {
            // Simple coherence measure based on sentence length consistency
            const lengths = sentences.map(s => s.trim().split(/\s+/).length);
            const variance = lengths.reduce((acc, len, _, arr) => {
                const mean = arr.reduce((a, b) => a + b) / arr.length;
                return acc + Math.pow(len - mean, 2);
            }, 0) / lengths.length;
            
            return variance < 50 ? 'High' : variance < 100 ? 'Medium' : 'Low';
        }

        function calculateOriginality(text) {
            // Check for common phrases that might indicate generated content
            const commonPhrases = [
                'it is important to note',
                'in conclusion',
                'furthermore',
                'it should be noted',
                'in summary'
            ];
            
            let commonCount = 0;
            commonPhrases.forEach(phrase => {
                if (text.toLowerCase().includes(phrase)) commonCount++;
            });
            
            const originalityScore = Math.max(0, 100 - (commonCount * 15));
            return originalityScore.toFixed(1) + '%';
        }

        function calculateEnsembleScore(perplexity, ngramAnalysis, styleDNA, patterns) {
            // Multi-factor ensemble scoring
            let aiScore = 0;
            
            // Perplexity contribution (lower = more AI-like)
            const perplexityValue = parseFloat(perplexity.value);
            aiScore += perplexityValue < 50 ? 30 : perplexityValue < 100 ? 15 : 0;
            
            // N-gram pattern contribution
            aiScore += ngramAnalysis.aiPatternScore * 5;
            
            // Repetition score contribution
            aiScore += parseFloat(ngramAnalysis.repetitionScore) > 2 ? 20 : 0;
            
            // Vocabulary diversity (very high can indicate AI)
            const vocabDiv = parseFloat(styleDNA.vocabularyDiversity);
            aiScore += vocabDiv > 80 ? 25 : vocabDiv < 40 ? 15 : 0;
            
            // Sentence variance (low variance = AI-like)
            aiScore += parseFloat(styleDNA.sentenceVariance) < 20 ? 20 : 0;
            
            // Ensure score is between 0-100
            aiScore = Math.min(100, Math.max(0, aiScore));
            
            // Calculate confidence based on multiple factors
            const confidence = Math.min(95, 70 + (aiScore > 50 ? 15 : 0) + (ngramAnalysis.aiPatternScore > 0 ? 10 : 0));
            
            // Calculate assistance level (more nuanced than binary)
            const assistanceLevel = aiScore > 75 ? 'High (70-100%)' : 
                                  aiScore > 50 ? 'Medium (40-70%)' : 
                                  aiScore > 25 ? 'Low (10-40%)' : 'Minimal (0-10%)';
            
            return {
                aiProbability: aiScore,
                confidence,
                assistanceLevel
            };
        }

        function showResults(results, originalText) {
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('algorithmSteps').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'block';
            
            // Theater mode animation
            animateScore(results.aiScore);
            
            // Update all result fields
            document.getElementById('detectedModel').textContent = results.modelDetection.model;
            document.getElementById('modelConfidence').textContent = results.modelDetection.confidence;
            document.getElementById('assistanceLevel').textContent = results.assistanceLevel;
            
            // Risk assessment
            const riskElement = document.getElementById('riskLevel');
            if (results.aiScore > 70) {
                riskElement.textContent = 'High';
                riskElement.className = 'risk-indicator risk-high';
            } else if (results.aiScore > 40) {
                riskElement.textContent = 'Medium';
                riskElement.className = 'risk-indicator risk-medium';
            } else {
                riskElement.textContent = 'Low';
                riskElement.className = 'risk-indicator risk-low';
            }
            
            // Writing style DNA
            document.getElementById('perplexityScore').textContent = results.perplexity.value + ' (' + results.perplexity.interpretation + ')';
            document.getElementById('sentenceVariance').textContent = results.styleDNA.sentenceVariance;
            document.getElementById('vocabDiversity').textContent = results.styleDNA.vocabularyDiversity;
            document.getElementById('temporalConsistency').textContent = results.styleDNA.temporalConsistency;
            
            // Plagiarism results
            document.getElementById('plagiarismScore').textContent = results.plagiarismResults.score;
            document.getElementById('sourcesFound').textContent = results.plagiarismResults.sources;
            document.getElementById('similarityThreshold').textContent = results.plagiarismResults.threshold;
            document.getElementById('webScanStatus').textContent = results.plagiarismResults.status;
            
            // Advanced analytics
            document.getElementById('textAuthenticity').textContent = (100 - results.aiScore).toFixed(1) + '%';
            document.getElementById('patternRecognition').textContent = results.patterns.complexityScore;
            document.getElementById('statConfidence').textContent = results.confidence.toFixed(1) + '%';
            document.getElementById('overallQuality').textContent = results.patterns.originalityScore;
            
            // Show highlighted text with AI signatures
            if (results.aiScore > 30) {
                showHighlightedText(originalText, results);
            }
        }

        function animateScore(score) {
            const scoreElement = document.getElementById('aiScore');
            const detectionElement = document.getElementById('primaryDetection');
            
            let currentScore = 0;
            const increment = score / 50; // 50 steps for smooth animation
            
            const animation = setInterval(() => {
                currentScore += increment;
                if (currentScore >= score) {
                    currentScore = score;
                    clearInterval(animation);
                }
                
                scoreElement.textContent = Math.round(currentScore) + '%';
                
                // Update detection label
                if (currentScore > 70) {
                    detectionElement.textContent = 'High AI Probability Detected';
                    scoreElement.style.color = '#dc3545';
                } else if (currentScore > 40) {
                    detectionElement.textContent = 'Moderate AI Assistance Detected';
                    scoreElement.style.color = '#ffc107';
                } else {
                    detectionElement.textContent = 'Likely Human-Written';
                    scoreElement.style.color = '#28a745';
                }
            }, 50);
        }

        function showHighlightedText(text, results) {
            const highlightedContainer = document.getElementById('highlightedText');
            const textWithHighlights = document.getElementById('textWithHighlights');
            
            // Simple highlighting of potential AI patterns
            let highlightedText = text;
            
            // Highlight formal transition words
            const aiPatterns = [
                'furthermore', 'moreover', 'consequently', 'nevertheless', 'therefore',
                'comprehensive', 'multifaceted', 'paradigm', 'optimization', 'sophisticated'
            ];
            
            aiPatterns.forEach(pattern => {
                const regex = new RegExp(`\\b${pattern}\\b`, 'gi');
                highlightedText = highlightedText.replace(regex, 
                    `<span class="ai-highlight">${pattern}<span class="tooltip">AI pattern detected</span></span>`
                );
            });
            
            textWithHighlights.innerHTML = highlightedText;
            highlightedContainer.style.display = 'block';
        }

        function generateReport() {
            // Generate a comprehensive report
            const reportData = gatherReportData();
            const reportContent = generateReportContent(reportData);
            downloadReport(reportContent);
        }

        function gatherReportData() {
            return {
                aiScore: document.getElementById('aiScore').textContent,
                detectedModel: document.getElementById('detectedModel').textContent,
                confidence: document.getElementById('modelConfidence').textContent,
                riskLevel: document.getElementById('riskLevel').textContent,
                timestamp: new Date().toLocaleString()
            };
        }

        function generateReportContent(data) {
            return `
AI Detection & Plagiarism Analysis Report
Generated: ${data.timestamp}

EXECUTIVE SUMMARY
================
AI Detection Score: ${data.aiScore}
Detected Model: ${data.detectedModel}
Confidence Level: ${data.confidence}
Risk Assessment: ${data.riskLevel}

DETAILED ANALYSIS
================
This report was generated by AI Detection Pro using advanced algorithms including:
- Perplexity calculation using entropy formulas
- N-gram analysis for pattern recognition
- AI model fingerprinting technology
- Writing style DNA analysis
- Statistical pattern recognition

For full details, please refer to the complete analysis interface.

Report generated by AI Detection & Plagiarism Checker Pro
            `;
        }

        function downloadReport(content) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ai-detection-report.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function explainResults() {
            const aiScore = document.getElementById('aiScore').textContent;
            const model = document.getElementById('detectedModel').textContent;
            
            let explanation = `Based on our analysis, this text received an AI detection score of ${aiScore}.\n\n`;
            
            if (parseInt(aiScore) > 70) {
                explanation += "HIGH AI PROBABILITY:\n";
                explanation += "• Low perplexity indicating predictable word patterns\n";
                explanation += "• High use of formal transition words\n";
                explanation += "• Consistent sentence structure typical of AI\n";
                explanation += `• Linguistic patterns matching ${model} model\n`;
            } else if (parseInt(aiScore) > 40) {
                explanation += "MODERATE AI ASSISTANCE:\n";
                explanation += "• Some AI-like patterns detected\n";
                explanation += "• Mixed writing style characteristics\n";
                explanation += "• Possible human editing of AI content\n";
            } else {
                explanation += "LIKELY HUMAN-WRITTEN:\n";
                explanation += "• High perplexity and natural variation\n";
                explanation += "• Irregular sentence patterns\n";
                explanation += "• Natural vocabulary distribution\n";
            }
            
            alert(explanation);
        }

        function shareResults() {
            const score = document.getElementById('aiScore').textContent;
            const model = document.getElementById('detectedModel').textContent;
            
            const shareText = `AI Detection Results: ${score} AI probability, detected model: ${model}. Analyzed with AI Detection Pro.`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'AI Detection Results',
                    text: shareText
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Results copied to clipboard!');
                });
            }
        }

        function resetAnalysis() {
            document.getElementById('textInput').value = '';
            document.getElementById('fileInput').value = '';
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('algorithmSteps').style.display = 'none';
            document.getElementById('highlightedText').style.display = 'none';
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Add missing functions to fix the ReferenceErrors
        function loadSample(type) {
            loadSampleText(type);
        }

        function analyzeContent() {
            analyzeText();
        }
    </script>
</body>
</html>
