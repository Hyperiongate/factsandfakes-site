<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Detection & Plagiarism Checker</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .tool-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 50px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
        }
        
        .input-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            border-bottom: 3px solid #e2e8f0;
        }
        
        .input-tab {
            padding: 15px 30px;
            border: none;
            background: #f8fafc;
            color: #6b7280;
            font-weight: 600;
            cursor: pointer;
            border-radius: 15px 15px 0 0;
            transition: all 0.3s ease;
            font-size: 1rem;
            border-bottom: 3px solid transparent;
        }
        
        .input-tab.active {
            background: white;
            color: #667eea;
            border-bottom-color: #667eea;
            box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .input-content {
            display: none;
        }
        
        .input-content.active {
            display: block;
            animation: fadeInUp 0.4s ease;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: #4a5568;
            font-size: 1.1rem;
        }
        
        .input-group textarea {
            width: 100%;
            padding: 18px;
            border: 3px solid #e2e8f0;
            border-radius: 15px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
            min-height: 140px;
            resize: vertical;
            line-height: 1.6;
        }
        
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
        
        .file-upload {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: rgba(102, 126, 234, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .file-upload.dragover {
            background: rgba(102, 126, 234, 0.15);
            border-color: #4c63d2;
            transform: scale(1.02);
        }
        
        .file-upload-icon { font-size: 3rem; color: #667eea; margin-bottom: 15px; }
        .file-upload h3 { color: #4a5568; margin-bottom: 10px; font-size: 1.2rem; }
        .file-upload p { color: #718096; font-size: 1rem; }
        
        .char-counter {
            text-align: right;
            font-size: 0.95rem;
            color: #6b7280;
            margin-top: 8px;
            font-weight: 500;
        }
        
        .analyze-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px 50px;
            border-radius: 20px;
            font-size: 1.3rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s ease;
            width: 100%;
            margin-bottom: 40px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .analyze-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }
        
        .progress-container {
            display: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px 30px;
            border-radius: 15px;
            margin: 20px 0;
            color: white;
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.3);
        }
        
        .progress-text {
            text-align: center;
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.25);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88 0%, #00cc44 100%);
            border-radius: 15px;
            transition: width 1.5s ease;
            width: 0%;
        }
        
        .progress-details {
            text-align: center;
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .results {
            display: none;
            margin-top: 40px;
        }
        
        .message {
            margin-top: 15px;
            padding: 15px;
            border-radius: 15px;
            font-weight: 600;
        }
        
        .message.success {
            background: rgba(0, 204, 68, 0.1);
            border-left: 4px solid #00cc44;
            color: #0d4718;
        }
        
        .message.error {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
            color: #7f1d1d;
        }
        
        .message.info {
            background: rgba(102, 126, 234, 0.1);
            border-left: 4px solid #667eea;
            color: #364676;
        }
        
        .message.warning {
            background: rgba(255, 170, 0, 0.1);
            border-left: 4px solid #ffaa00;
            color: #856404;
        }
        
        .highlight-ai {
            background: linear-gradient(135deg, rgba(255, 68, 68, 0.3), rgba(255, 107, 107, 0.2));
            padding: 2px 4px;
            border-radius: 4px;
            border-bottom: 2px solid #ff4444;
            cursor: help;
        }
        
        .highlight-plagiarism {
            background: linear-gradient(135deg, rgba(255, 142, 83, 0.3), rgba(255, 170, 0, 0.2));
            padding: 2px 4px;
            border-radius: 4px;
            border-bottom: 2px solid #ff8e53;
            cursor: help;
        }
        
        .analyzed-text-container {
            background: #f8fafc;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 2px solid #e2e8f0;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .analyzed-text {
            line-height: 1.8;
            font-size: 1rem;
            color: #374151;
        }
        
        .highlight-legend {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .legend-ai { background: linear-gradient(135deg, rgba(255, 68, 68, 0.7), rgba(255, 107, 107, 0.5)); }
        .legend-plagiarism { background: linear-gradient(135deg, rgba(255, 142, 83, 0.7), rgba(255, 170, 0, 0.5)); }
        
        .source-match {
            background: rgba(255, 142, 83, 0.1);
            border-left: 4px solid #ff8e53;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        
        #fileInputElement {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-shield-alt"></i> AI Detection & Plagiarism Checker</h1>
            <p>Enterprise AI-Powered Content Authenticity Platform</p>
        </div>

        <div class="tool-container">
            <div style="text-align: center; margin-bottom: 40px;">
                <h2 style="font-size: 2.8rem; color: #4a5568; margin-bottom: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"><i class="fas fa-search"></i> Content Authenticity Analysis</h2>
                <p style="font-size: 1.2rem; color: #718096;">Advanced AI detection & plagiarism verification</p>
            </div>

            <div style="display: flex; gap: 20px; justify-content: center; margin-bottom: 40px; flex-wrap: wrap;">
                <button style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: 3px solid #667eea; font-weight: 600; cursor: pointer; border-radius: 20px; padding: 20px 35px; font-size: 1.1rem; box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3); transform: translateY(-3px);" id="freeBtn" onclick="selectTier('free')">
                    üÜì Free Analysis
                </button>
                <button style="background: linear-gradient(145deg, #f8fafc, #e2e8f0); color: #4a5568; border: 3px solid #e2e8f0; font-weight: 600; cursor: pointer; border-radius: 20px; padding: 20px 35px; font-size: 1.1rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);" id="trialBtn" onclick="selectTier('trial')">
                    ‚≠ê Premium Trial
                </button>
            </div>

            <div class="input-section">
                <div class="input-tabs">
                    <button class="input-tab active" onclick="switchInputType('text')">üìù Paste Content</button>
                    <button class="input-tab" onclick="switchInputType('file')">üìÅ Upload Document</button>
                </div>
                
                <div class="input-content active" id="textInput">
                    <div style="margin-bottom: 20px; background: rgba(102, 126, 234, 0.05); padding: 15px; border-radius: 12px;">
                        <label style="font-size: 0.95rem; margin-bottom: 10px; font-weight: 600; color: #4a5568; display: block;">üìö Try Sample Content:</label>
                        <div>
                            <button style="background: rgba(102, 126, 234, 0.1); border: 1px solid #667eea; color: #667eea; padding: 8px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; cursor: pointer; margin: 4px;" onclick="loadSample('ai_generated')">ü§ñ AI-Generated</button>
                            <button style="background: rgba(102, 126, 234, 0.1); border: 1px solid #667eea; color: #667eea; padding: 8px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; cursor: pointer; margin: 4px;" onclick="loadSample('human_written')">‚úçÔ∏è Human-Written</button>
                            <button style="background: rgba(102, 126, 234, 0.1); border: 1px solid #667eea; color: #667eea; padding: 8px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; cursor: pointer; margin: 4px;" onclick="loadSample('mixed_content')">üîÄ Mixed Content</button>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="content-text"><i class="fas fa-file-text"></i> Content for Analysis</label>
                        <textarea id="content-text" placeholder="Paste your content here for analysis..." oninput="updateCharCount()"></textarea>
                        <div class="char-counter" id="charCounter">0 characters</div>
                    </div>
                </div>
                
                <div class="input-content" id="fileInput">
                    <div class="input-group">
                        <label><i class="fas fa-file-upload"></i> Document Upload</label>
                        <div class="file-upload" id="fileUpload">
                            <div class="file-upload-icon">üìÑ</div>
                            <h3>Drop files here or click to upload</h3>
                            <p>Supports: TXT, PDF, DOCX files (max 10MB)</p>
                        </div>
                        <input type="file" id="fileInputElement" accept=".txt,.pdf,.docx">
                        <div id="uploadMessages"></div>
                    </div>
                </div>

                <button class="analyze-btn" onclick="analyzeContent()">
                    <i class="fas fa-search"></i> Launch Professional Analysis (FREE)
                </button>

                <div class="progress-container" id="progressContainer">
                    <div class="progress-text" id="progressText">Initializing Analysis...</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-details" id="progressDetails">Preparing systems...</div>
                </div>

                <div class="results" id="results"></div>
            </div>
        </div>
    </div>

    <script>
        // ============== GLOBAL VARIABLES - DECLARED ONCE ==============
        var currentInputType = 'text';
        var currentTier = 'free';

        var sampleTexts = {
            ai_generated: "Furthermore, it is important to note that artificial intelligence represents a paradigm shift in how we approach content creation. Moreover, this innovative technology leverages advanced algorithms to optimize the writing process. Additionally, comprehensive studies indicate that these cutting-edge solutions provide significant benefits across multiple industries. In conclusion, the implementation of AI-driven systems streamlines operations and enhances productivity.",
            
            human_written: "I can't believe what happened today! So I was walking to the coffee shop around the corner from my apartment, and I see this guy just standing there with like 20 dogs. Twenty! I'm not even exaggerating. Some were huge German Shepherds, others were tiny Chihuahuas, and they were all just chilling together. Turns out he runs a dog-walking service and was doing a group walk. Made my morning honestly - sometimes you just need to see something that makes you smile.",
            
            mixed_content: "According to recent studies, machine learning algorithms have demonstrated significant improvements in natural language processing tasks. However, I've personally noticed that when I use AI writing tools, the output often feels somewhat robotic and lacks the personal touch that makes writing engaging. The technology is impressive, don't get me wrong, but there's still something special about human creativity that can't be replicated."
        };

        // ============== GLOBAL FUNCTIONS - PROPERLY SCOPED ==============
        function updateCharCount() {
            var textarea = document.getElementById('content-text');
            var counter = document.getElementById('charCounter');
            if (!textarea || !counter) return;
            
            var length = textarea.value.length;
            counter.textContent = length.toLocaleString() + ' characters';
            
            if (length > 5000) {
                counter.className = 'char-counter error';
                counter.textContent += ' (‚ö†Ô∏è Too long)';
            } else if (length > 100) {
                counter.className = 'char-counter';
                counter.textContent += ' (‚úÖ Good length)';
            } else {
                counter.className = 'char-counter';
            }
        }

        function showMessage(type, text) {
            var container = document.getElementById('uploadMessages');
            if (!container) return;
            
            var message = document.createElement('div');
            message.className = 'message ' + type;
            message.innerHTML = '<strong>' + type.toUpperCase() + ':</strong> ' + text;
            
            var existing = container.querySelector('.message.' + type);
            if (existing) existing.remove();
            
            container.appendChild(message);
            
            if (type === 'info') {
                setTimeout(function() {
                    if (message.parentNode) message.remove();
                }, 5000);
            }
        }

        function updateProgress(percentage, text, detail) {
            var progressFill = document.getElementById('progressFill');
            var progressText = document.getElementById('progressText');
            var progressDetails = document.getElementById('progressDetails');
            
            if (progressFill) progressFill.style.width = percentage + '%';
            if (progressText) progressText.textContent = text;
            if (progressDetails) progressDetails.textContent = detail || '';
        }

        function showProgress() {
            var progressContainer = document.getElementById('progressContainer');
            if (progressContainer) {
                progressContainer.style.display = 'block';
                updateProgress(0, 'Initializing Analysis...', 'Preparing systems...');
            }
        }

        function hideProgress() {
            var progressContainer = document.getElementById('progressContainer');
            if (progressContainer) progressContainer.style.display = 'none';
        }

        function switchInputType(type) {
            currentInputType = type;
            
            var tabs = document.querySelectorAll('.input-tab');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
                if ((type === 'text' && i === 0) || (type === 'file' && i === 1)) {
                    tabs[i].classList.add('active');
                }
            }
            
            var contents = document.querySelectorAll('.input-content');
            for (var i = 0; i < contents.length; i++) {
                contents[i].classList.remove('active');
            }
            
            var targetContent = document.getElementById(type + 'Input');
            if (targetContent) {
                setTimeout(function() {
                    targetContent.classList.add('active');
                }, 150);
            }
        }

        function selectTier(tier) {
            currentTier = tier;
            
            var freeBtn = document.getElementById('freeBtn');
            var trialBtn = document.getElementById('trialBtn');
            
            if (tier === 'free') {
                freeBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                freeBtn.style.color = 'white';
                freeBtn.style.transform = 'translateY(-3px)';
                freeBtn.style.boxShadow = '0 8px 25px rgba(102, 126, 234, 0.3)';
                
                trialBtn.style.background = 'linear-gradient(145deg, #f8fafc, #e2e8f0)';
                trialBtn.style.color = '#4a5568';
                trialBtn.style.transform = 'none';
                trialBtn.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.1)';
            } else {
                trialBtn.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%)';
                trialBtn.style.color = 'white';
                trialBtn.style.transform = 'translateY(-3px)';
                trialBtn.style.boxShadow = '0 8px 25px rgba(255, 107, 107, 0.3)';
                
                freeBtn.style.background = 'linear-gradient(145deg, #f8fafc, #e2e8f0)';
                freeBtn.style.color = '#4a5568';
                freeBtn.style.transform = 'none';
                freeBtn.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.1)';
            }

            var analyzeBtn = document.querySelector('.analyze-btn');
            if (analyzeBtn) {
                if (tier === 'free') {
                    analyzeBtn.innerHTML = '<i class="fas fa-search"></i> Launch Professional Analysis (FREE)';
                    analyzeBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                } else {
                    analyzeBtn.innerHTML = '<i class="fas fa-star"></i> Launch Premium Analysis (TRIAL)';
                    analyzeBtn.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%)';
                }
            }
        }

        function loadSample(type) {
            var textarea = document.getElementById('content-text');
            if (textarea && sampleTexts[type]) {
                textarea.value = sampleTexts[type];
                updateCharCount();
                
                if (currentInputType !== 'text') {
                    switchInputType('text');
                }
            }
        }

        function analyzeContent() {
            var textInput = document.getElementById('content-text');
            if (!textInput) {
                alert('Please enter some text to analyze or upload a document.');
                return;
            }
            
            var text = textInput.value.trim();
            if (!text) {
                alert('Please enter some text to analyze or upload a document.');
                return;
            }

            if (text.length < 50) {
                alert('Please enter at least 50 characters for accurate analysis.');
                return;
            }

            var analyzeBtn = document.querySelector('.analyze-btn');
            if (analyzeBtn) {
                analyzeBtn.disabled = true;
                analyzeBtn.innerHTML = 'üî¨ Analyzing...';
            }

            showProgress();
            var resultsDiv = document.getElementById('results');
            if (resultsDiv) resultsDiv.style.display = 'none';

            setTimeout(function() {
                updateProgress(20, 'ü§ñ AI Content Analysis...', 'Running detection algorithms');
                setTimeout(function() {
                    updateProgress(50, 'üîç Plagiarism Check...', 'Checking sources');
                    setTimeout(function() {
                        updateProgress(80, 'üìä Analysis Complete...', 'Generating results');
                        setTimeout(function() {
                            updateProgress(100, '‚úÖ Done!', 'Results ready');
                            setTimeout(function() {
                                hideProgress();
                                showEnhancedResults(text);
                                if (analyzeBtn) {
                                    analyzeBtn.disabled = false;
                                    analyzeBtn.innerHTML = currentTier === 'free' ? 
                                        '<i class="fas fa-search"></i> Launch Professional Analysis (FREE)' : 
                                        '<i class="fas fa-star"></i> Launch Premium Analysis (TRIAL)';
                                }
                            }, 500);
                        }, 800);
                    }, 1000);
                }, 1000);
            }, 500);
        }

        function hashCode(str) {
            var hash = 0;
            for (var i = 0; i < str.length; i++) {
                var char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash;
        }

        function checkForPlagiarism(content) {
            var lowerContent = content.toLowerCase();
            var indicators = [];
            
            var famousQuotes = [
                "it was the best of times, it was the worst of times",
                "to be or not to be, that is the question", 
                "call me ishmael",
                "it is a truth universally acknowledged",
                "all happy families are alike",
                "frankly, my dear, i don't give a damn",
                "may the force be with you"
            ];
            
            for (var i = 0; i < famousQuotes.length; i++) {
                if (lowerContent.includes(famousQuotes[i])) {
                    indicators.push({type: 'famous_quote', content: famousQuotes[i]});
                }
            }
            
            return indicators;
        }

        function generateHighlightedText(content, tier) {
            if (!content || tier === 'free') return null;
            
            var sentences = content.split(/[.!?]+/).filter(function(s) { return s.trim().length > 20; });
            if (sentences.length === 0) return content;
            
            var highlightedText = '';
            var aiCount = 0, plagiarismCount = 0;
            
            var famousQuotes = [
                { quote: "it was the best of times, it was the worst of times", author: "Charles Dickens" },
                { quote: "to be or not to be, that is the question", author: "William Shakespeare" },
                { quote: "call me ishmael", author: "Herman Melville" },
                { quote: "frankly, my dear, i don't give a damn", author: "Margaret Mitchell" },
                { quote: "may the force be with you", author: "George Lucas" }
            ];
            
            for (var i = 0; i < sentences.length; i++) {
                var processedSentence = sentences[i].trim();
                if (!processedSentence) continue;
                
                if (!processedSentence.match(/[.!?]$/)) {
                    processedSentence += '.';
                }
                
                var sentenceLower = processedSentence.toLowerCase();
                var foundQuote = null;
                
                for (var j = 0; j < famousQuotes.length; j++) {
                    if (sentenceLower.includes(famousQuotes[j].quote)) {
                        foundQuote = famousQuotes[j];
                        break;
                    }
                }
                
                var aiKeywords = ['furthermore', 'moreover', 'additionally', 'paradigm shift', 'cutting-edge', 'streamlines'];
                var hasAIKeywords = false;
                for (var k = 0; k < aiKeywords.length; k++) {
                    if (processedSentence.toLowerCase().includes(aiKeywords[k])) {
                        hasAIKeywords = true;
                        break;
                    }
                }
                
                if (foundQuote) {
                    highlightedText += '<span class="highlight-plagiarism" title="PLAGIARISM: Quote from ' + foundQuote.author + '">' + processedSentence + '</span> ';
                    plagiarismCount++;
                } else if (hasAIKeywords) {
                    highlightedText += '<span class="highlight-ai" title="AI Pattern Detected">' + processedSentence + '</span> ';
                    aiCount++;
                } else {
                    highlightedText += processedSentence + ' ';
                }
            }
            
            return {
                text: highlightedText.trim(),
                counts: { ai: aiCount, plagiarism: plagiarismCount, suspicious: 0 }
            };
        }

        function generatePlagiarismSources(content, tier) {
            if (tier === 'free') return [];
            
            var lowerContent = content.toLowerCase();
            var sources = [];
            
            var famousQuotes = [
                { quote: "it was the best of times, it was the worst of times", author: "Charles Dickens", work: "A Tale of Two Cities" },
                { quote: "to be or not to be, that is the question", author: "William Shakespeare", work: "Hamlet" },
                { quote: "call me ishmael", author: "Herman Melville", work: "Moby Dick" },
                { quote: "frankly, my dear, i don't give a damn", author: "Margaret Mitchell", work: "Gone with the Wind" },
                { quote: "may the force be with you", author: "George Lucas", work: "Star Wars" }
            ];
            
            for (var i = 0; i < famousQuotes.length; i++) {
                if (lowerContent.includes(famousQuotes[i].quote)) {
                    sources.push({
                        title: famousQuotes[i].work,
                        author: famousQuotes[i].author,
                        similarity: 100,
                        type: "Literary Work",
                        url: "literature-database.org/classics",
                        excerpt: famousQuotes[i].quote,
                        confidence: "Very High"
                    });
                }
            }
            
            return sources;
        }

        function showEnhancedResults(text) {
            var results = document.getElementById('results');
            if (!results) return;
            
            var textLength = text.length;
            var textLower = text.toLowerCase();
            var hash = 0;
            for (var i = 0; i < text.length; i++) {
                var char = text.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            var normalizedHash = Math.abs(hash) / 2147483647;
            
            var baseScore = 45 + (normalizedHash * 40);
            var aiFlags = 0;
            
            var aiIndicators = {
                transitionalPhrases: (textLower.match(/\b(furthermore|moreover|additionally|consequently|therefore)\b/g) || []).length,
                corporateBuzzwords: (textLower.match(/\b(paradigm shift|cutting-edge|streamlines|optimization)\b/g) || []).length,
                genericDescriptors: (textLower.match(/\b(comprehensive|innovative|significant|advanced)\b/g) || []).length
            };
            
            var totalAIIndicators = aiIndicators.transitionalPhrases + aiIndicators.corporateBuzzwords + aiIndicators.genericDescriptors;
            var enhancedAIProbability = Math.min(85, Math.max(5, (totalAIIndicators * 15) + (normalizedHash * 25)));
            var aiProbabilityPercent = Math.round(enhancedAIProbability);
            
            if (totalAIIndicators > 3) {
                baseScore = Math.max(15, baseScore - 30);
                aiFlags = totalAIIndicators;
            }
            
            var plagiarismIndicators = checkForPlagiarism(text);
            if (plagiarismIndicators.length > 0) {
                baseScore = Math.max(10, baseScore - (plagiarismIndicators.length * 20));
            }
            
            baseScore = Math.max(10, Math.min(95, baseScore));
            
            var highlightedData = generateHighlightedText(text, currentTier);
            var plagiarismSources = generatePlagiarismSources(text, currentTier);
            
            var scoreColor = baseScore >= 80 ? '#10b981' : baseScore >= 65 ? '#059669' : baseScore >= 50 ? '#f59e0b' : '#ef4444';
            var assessment = baseScore >= 85 ? 'Highly Authentic' : baseScore >= 70 ? 'Generally Authentic' : baseScore >= 55 ? 'Moderately Authentic' : 'Questionable';
            
            var conversationalAnalysis = 'I analyzed your ' + textLength + '-character text and found ' + totalAIIndicators + ' AI indicators and ' + plagiarismIndicators.length + ' plagiarism matches. The authenticity score is ' + Math.round(baseScore) + '% with ' + aiProbabilityPercent + '% AI probability.';
            
            results.innerHTML = 
                '<div style="background: white; border-radius: 25px; padding: 40px; box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);">' +
                    '<div style="display: flex; align-items: center; gap: 20px; margin-bottom: 30px;">' +
                        '<div style="width: 100px; height: 100px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; font-weight: 900; color: white; background: ' + scoreColor + ';">' + Math.round(baseScore) + '</div>' +
                        '<div>' +
                            '<div style="font-size: 1.5rem; font-weight: 800; color: ' + scoreColor + ';">' + assessment + '</div>' +
                            '<div style="font-size: 1.1rem; opacity: 0.8;">AI Probability: ' + aiProbabilityPercent + '%</div>' +
                        '</div>' +
                    '</div>' +
                    
                    '<div style="background: #f8fafc; border-radius: 20px; padding: 30px; margin: 25px 0; border-left: 6px solid #667eea;">' +
                        '<h4 style="color: #667eea; margin-bottom: 20px;"><i class="fas fa-comments"></i> Analysis Report</h4>' +
                        '<p style="color: #374151; line-height: 1.7;">' + conversationalAnalysis + '</p>' +
                    '</div>' +
                    
                    (currentTier === 'trial' && highlightedData ? 
                        '<div style="margin-top: 30px;">' +
                            '<h3 style="color: #667eea; margin-bottom: 20px;"><i class="fas fa-highlighter"></i> Text Highlighting</h3>' +
                            '<div class="highlight-legend">' +
                                '<div class="legend-item"><div class="legend-color legend-ai"></div><span>AI Patterns (' + (highlightedData.counts.ai || 0) + ')</span></div>' +
                                '<div class="legend-item"><div class="legend-color legend-plagiarism"></div><span>Plagiarism (' + (highlightedData.counts.plagiarism || 0) + ')</span></div>' +
                            '</div>' +
                            '<div class="analyzed-text-container"><div class="analyzed-text">' + highlightedData.text + '</div></div>' +
                        '</div>' : 
                        '<div style="text-align: center; padding: 30px; background: rgba(255, 107, 107, 0.1); border-radius: 15px; margin-top: 20px;">' +
                            '<h4 style="color: #ff6b6b;">üîì Unlock Premium Features</h4>' +
                            '<p>Get text highlighting, plagiarism detection, and detailed analysis</p>' +
                            '<button onclick="selectTier(\'trial\')" style="background: #ff6b6b; color: white; border: none; padding: 12px 25px; border-radius: 10px; font-weight: 700; cursor: pointer;">Upgrade Now</button>' +
                        '</div>'
                    ) +
                    
                    (plagiarismSources.length > 0 ? 
                        '<div style="margin-top: 30px;">' +
                            '<h3 style="color: #667eea; margin-bottom: 20px;"><i class="fas fa-search"></i> Plagiarism Detected</h3>' +
                            plagiarismSources.map(function(source) {
                                return '<div class="source-match">' +
                                    '<h5 style="color: #ff8e53;">' + source.title + ' - ' + source.similarity + '% match</h5>' +
                                    '<p><strong>Author:</strong> ' + source.author + '</p>' +
                                    '<p style="font-style: italic;">"' + source.excerpt + '"</p>' +
                                '</div>';
                            }).join('') +
                        '</div>' : ''
                    ) +
                '</div>';
            
            results.style.display = 'block';
            results.scrollIntoView({ behavior: 'smooth' });
        }

        function initializeFileUpload() {
            var fileUploadArea = document.getElementById('fileUpload');
            var fileInputElement = document.getElementById('fileInputElement');
            
            if (!fileUploadArea || !fileInputElement) {
                console.error('File upload elements not found!');
                return;
            }

            fileUploadArea.addEventListener('click', function(e) {
                e.preventDefault();
                showMessage('info', 'Opening file picker...');
                fileInputElement.click();
            });

            fileInputElement.addEventListener('change', function(e) {
                if (e.target.files && e.target.files.length > 0) {
                    handleFileUpload(e);
                }
            });

            fileUploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.stopPropagation();
                fileUploadArea.classList.add('dragover');
            });

            fileUploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                e.stopPropagation();
                fileUploadArea.classList.remove('dragover');
            });

            fileUploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                fileUploadArea.classList.remove('dragover');
                
                if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                    var fakeEvent = {
                        target: {
                            files: e.dataTransfer.files
                        }
                    };
                    handleFileUpload(fakeEvent);
                }
            });

            showMessage('success', 'Upload interface ready');
        }

        async function handleFileUpload(event) {
            var file = event.target.files[0];
            if (!file) return;

            var sizeKB = (file.size / 1024).toFixed(1);
            showMessage('info', 'Selected: ' + file.name + ' (' + sizeKB + ' KB)');

            if (file.size > 10 * 1024 * 1024) {
                showMessage('error', 'File too large! Please choose a file smaller than 10MB.');
                return;
            }

            var allowedTypes = ['text/plain', 'application/pdf', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            var isValidType = allowedTypes.includes(file.type) || file.name.match(/\.(txt|pdf|docx)$/i);
            
            if (!isValidType) {
                showMessage('error', 'Unsupported file type! Please choose TXT, PDF, or DOCX files.');
                return;
            }

            showMessage('warning', 'Processing "' + file.name + '"... Please wait.');

            try {
                var formData = new FormData();
                formData.append('file', file);

                var response = await fetch('https://ai-detector-backend-g4mj.onrender.com/api/extract-text', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('HTTP ' + response.status + ': ' + response.statusText);
                }

                var data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }

                var textarea = document.getElementById('content-text');
                textarea.value = data.text || '';
                updateCharCount();
                
                switchInputType('text');
                
                showMessage('success', '‚úÖ Successfully processed "' + (data.filename || file.name) + '"! ' + (data.text ? data.text.length : 0) + ' characters extracted.');

            } catch (error) {
                console.error('Upload error:', error);
                
                if (file.name.toLowerCase().endsWith('.txt')) {
                    try {
                        var reader = new FileReader();
                        reader.onload = function(e) {
                            var textarea = document.getElementById('content-text');
                            textarea.value = e.target.result;
                            updateCharCount();
                            switchInputType('text');
                            showMessage('success', '‚úÖ TXT file loaded successfully! ' + e.target.result.length + ' characters.');
                        };
                        reader.onerror = function() {
                            showMessage('error', 'Failed to read file locally.');
                        };
                        reader.readAsText(file);
                        return;
                    } catch (fallbackError) {
                        console.error('Fallback failed:', fallbackError);
                    }
                }
                
                showMessage('error', '‚ùå Upload failed: ' + error.message);
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing...');
            initializeFileUpload();
        });
    </script>
</body>
</html>
